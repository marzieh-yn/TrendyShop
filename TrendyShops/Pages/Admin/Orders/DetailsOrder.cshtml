@page
@model TrendyShops.Pages.Admin.Orders.DetailsOrderModel
@using TrendyShops.Utility
@{
    ViewData["Title"] = "Index";
    Layout = "~/Pages/Shared/_Layout2.cshtml";
}
@*<h2>Index</h2>

<section class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
            
            <!-- /.card -->

            <div class="card">
              <div class="card-header">
                <h3 class="card-title">Categories</h3>
              </div>
              <!-- /.card-header -->
              <div class="card-body">
                <table id="example1" class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>
                                    UserName
                                </th>
                                <th>
                                   Phone Number
                                </th>
                                <th>
                                    User Address
                                </th>
                                <th>
                                    Comments
                                </th>
                                <th>
                                 Total Product Price
                                </th>
                                <th>
                                  Pickup Name
                                </th>
                                <th>
                                  PickUp Time

                                </th>
                                <th>
                                    Order Date
                                </th>
                                <th>
                                    Status
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                   
                            <tr>
                                <td>
                                @foreach (var user in Model.model) {
                                   @if(user.Id == Model.OrderHeader.ApplicationUserId){
                                    @Html.DisplayFor(modelItem => user.UserName)
                                   }
                                }
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => Model.OrderHeader.Phone_Number)
                                </td>
                                <td>
                                   
                                  
                                    @Html.DisplayFor(modelItem => Model.OrderHeader.User_Address.Address) <p>,</p> @Html.DisplayFor(modelItem => Model.OrderHeader.User_Address.PostalCode)
                                    <p>,</p>@Html.DisplayFor(modelItem => Model.OrderHeader.User_Address.ExtraDetailes)
                                  
                                
                                </td>
                                <td>
                                     
                                     @Html.DisplayFor(modelItem => Model.OrderHeader.Comments)
                                     
                                </td>
                                <td>
                                  @Html.DisplayFor(modelItem => Model.OrderHeader.OrderTotal)
                                </td>
                                <td>
                                  @Html.DisplayFor(modelItem => Model.OrderHeader.PickupName)
                                </td>
                                <td>
                                  @Html.DisplayFor(modelItem => Model.OrderHeader.PickUpTime)
                                </td>
                                <td>
                                  @Html.DisplayFor(modelItem => Model.OrderHeader.OrderDate)
                                </td>
                                <td>
                                    <a asp-page="./ManageOrders/DetailsOrder" ></a>
                                </td>
                                <td>
                                @*    <a asp-page="./Edit" asp-route-id="@item.Id">Edit</a> |
                                    <a asp-page="./Details" asp-route-id="@item.Id">Details</a> |*@
                                    @*<a asp-page="./Delete" asp-route-id="" asp-page-handler="Delete">Delete</a>
                                </td>
                            </tr>
                  
                        </tbody>
                    </table>
                </div>
              <!-- /.card-body -->
            </div>
            <!-- /.card -->
          </div>
          <!-- /.col -->
        </div>
        <!-- /.row -->
      </div>
      <!-- /.container-fluid -->
    </section>*@
    <!-- /.content -->


<form method="post">
	<div class="border p-4 ml-1 backgroundWhite mt-4">
		<div class="row pb-1">
			<div class="col-12 col-md-6 ">
				<p class="h2  text-primary">Order Details</p>
			</div>
			<div class="col-12 col-md-4 offset-md-2">
				<a asp-page="./Index" class="btn btn-outline-primary form-control">Back to Orders </a>
			</div>
		</div>
		<hr />
		<div class="row pt-2">
			<div class="col-lg-8 col-12" style="border-right:1px solid #bbb9b9">
				<div class="form-group row py-1">
					<div class="col-md-3 col-12 text-primary">
						Name
					</div>
					<div class="col-md-9 col-12">
						<input asp-for="OrderDetailVM.OrderHeader.PickupName" disabled class="form-control" />
					</div>
				</div>
				<div class="form-group row py-1">
					<div class="col-md-3 col-12 text-primary">
						Email
					</div>
					<div class="col-md-9 col-12">
						@foreach (var user in Model.model) {
                                   @if(user.Id == Model.OrderDetailVM.OrderHeader.ApplicationUserId){
                                    @*@Html.DisplayFor(modelItem => user.UserName)*@
									<input value="@Html.DisplayFor(modelItem => user.UserName)" disabled class="form-control" />
                                   }
                                }
						@*<input asp-for="OrderDetailVM.OrderHeader.ApplicationUser.Email" disabled class="form-control" />*@
					</div>
				</div>
				<div class="form-group row py-1">
					<div class="col-md-3 col-12 text-primary">
						Address
					</div>
					<div class="col-md-9 col-12">
						
						<input value="@Model.OrderDetailVM.OrderHeader.User_Address.Address , @Model.OrderDetailVM.OrderHeader.User_Address.PostalCode, @Model.OrderDetailVM.OrderHeader.User_Address.ExtraDetailes" disabled class="form-control" />
					</div>
				</div>
				<div class="form-group row py-1">
					<div class="col-md-3 col-12 text-primary">
						Phone Number
					</div>
					<div class="col-md-9 col-12">
						<input asp-for="OrderDetailVM.OrderHeader.Phone_Number" disabled class="form-control" />
					</div>
				</div>
				<div class="form-group row py-1">
					<div class="col-md-3 col-12 text-primary">
						Order Total
					</div>
					<div class="col-md-9 col-12">
						<input disabled asp-for="OrderDetailVM.OrderHeader.OrderTotal" class="form-control" />
					</div>
				</div>
				<div class="form-group row py-1">
					<div class="col-md-3 col-12 text-primary">
						Order Pickup Date Time
					</div>
					<div class="col-md-9 col-12">
						<input value="@Model.OrderDetailVM.OrderHeader.PickUpTime.ToShortDateString() @Model.OrderDetailVM.OrderHeader.PickUpTime.ToShortTimeString()" disabled class="form-control" />
					</div>
				</div>
				<div class="form-group row py-1">
					<div class="col-md-3 col-12 text-primary">
						Comments
					</div>
					<div class="col-md-9 col-12">
						<textarea asp-for="OrderDetailVM.OrderHeader.Comments" disabled class="form-control" rows="3"></textarea>
					</div>
				</div>

			</div>

			<div class="col-lg-4 col-12">
				<button type="submit" disabled class="btn btn-outline-info form-control">@Model.OrderDetailVM.OrderHeader.Status</button>

				<h4 class="d-flex justify-content-between align-content-center mb-3 pt-3">
					<span class="text-muted">Order ID: </span>
					<span class="badge badge-secondary badge-pill">@Model.OrderDetailVM.OrderHeader.Id</span>
				</h4>
				<ul class="list-group mb-3">
					@foreach (var detail in Model.OrderDetailVM.OrderDetails)
					{
						<li class="list-group-item d-flex justify-content-between">
							<div>
								<h6 class="my-0">@detail.ProductName</h6>
								<small class="text-muted">Quantity : @detail.Count</small>
							</div>
							<span class="text-muted">$@(detail.ProductPrice*detail.Count)</span>
						</li>
					}

					<li class="list-group-item d-flex justify-content-between bg-light">
						<span class="text-info"> Total (USD)</span>
						<strong class="text-info">$@Model.OrderDetailVM.OrderHeader.OrderTotal</strong>
					</li>

				</ul>
				<div class="row pt-3">

					@if (Model.OrderDetailVM.OrderHeader.Status == SD.StatusReady
							&& (User.IsInRole(SD.ManagerRole)))
					{
						<div class="col-12 pb-2">
							<button type="submit" class="btn btn-primary form-control"
								asp-page-handler="OrderCompleted" asp-route-orderId="@Model.OrderDetailVM.OrderHeader.Id">
								Complete Order
							</button>
						</div>
					}
					@if ((User.IsInRole(SD.ManagerRole))
							&& (Model.OrderDetailVM.OrderHeader.Status == SD.StatusReady ||
							Model.OrderDetailVM.OrderHeader.Status == SD.StatusSubmitted ||
							Model.OrderDetailVM.OrderHeader.Status == SD.StatusInProcess)
							)
					{
						<div class="col-6">
							<button type="submit" class="btn btn-warning form-control"
								asp-page-handler="OrderCancel" asp-route-orderId="@Model.OrderDetailVM.OrderHeader.Id">
								<i class="bi bi-x-square"></i> Cancel Order
							</button>
						</div>
						<div class="col-6">
							<button type="submit" class="btn btn-danger form-control"
								asp-page-handler="OrderRefund" asp-route-orderId="@Model.OrderDetailVM.OrderHeader.Id">
								<i class="bi bi-currency-dollar"></i> Refund Order
							</button>
						</div>

					}
				</div>
			</div>
		</div>
	</div>
</form>


@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
   
}